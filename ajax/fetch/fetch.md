# Fetch

[Fetch API](https://github.github.io/fetch/)

`let promise = fetch(url, [options])`

`url` - URL для доступа, 
`options` - необязательные параметры: метод, заголовки...

Браузер сразу же запускает запрос и возвращает promise.

Получение ответа обычно двухэтапный процесс:

1. Сначала promise разрешается с помощью объекта встроенного класса Response, как только сервер отвечает заголовками.

    Мы можем проверить статус HTTP, чтобы увидеть, успешен он или нет, проверить заголовки, но пока не иметь тела.

2. Во-вторых, чтобы получить тело ответа, нам нужно использовать дополнительный вызов метода.

    - `response.json()` - проанализировать ответ как объект JSON
    - `response.text()` - вернуть ответ в виде текста
    - `response.formData()`- вернуть ответ как FormData
    - `response.blob()`- вернуть ответ как Blob
    - `response.arrayBuffer()` - вернуть ответ как ArrayBuffer

    Мы можем выбрать только один метод анализа тела.

    Если мы получили ответ с `response.text()`, то `response.json()` не будет работать, так как содержание тела уже обработано.

## POST-запросы

Чтобы сделать POST запрос или запрос другим методом, нам нужно использовать fetch параметры:

- `method` - HTTP-метод, например POST
- `body` - JSON, FormData

## Отправка запроса с учётными данными

- `credentials: 'include'`  
- `credentials: 'same-origin'` - только если URL принадлежит одному источнику (origin) что и вызывающий его скрипт
- `credentials: 'omit'` - учётные данные не передаются с запросом


## Проверка успешности запроса

В методе `fetch()` `promise` будет отклонён (reject) с `TypeError`, когда случится ошибка сети или не будет сконфигурирован CORS на стороне запрашиваемого сервера, хотя обычно это означает проблемы доступа или аналогичные — для примера, 404 не является сетевой ошибкой. 

Для достоверной проверки успешности `fetch()` будет включать проверку того, что `promise` успешен (resolved), затем проверку того, что  значение свойства `Response.ok` является true.

## Объекты ответа

Экземпляр `Response` будет возвращен когда `fetch()` промис будет исполнен.

Свойства объекта-ответа: 

- `status` - содержит код статуса ответа (Number, default 200) 
- `statusText` - HTTP коду статуса (String, default "OK")
- `ok` - статус ответа 200-299 (Boolean)

## Тело

Запрос и ответ могут содержать данные тела. 

Тело является экземпляром любого из следующих типов:

- ArrayBufferView
- Blob/File
- string
- URLSearchParams
- FormData
