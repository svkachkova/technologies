# WebSocket

https://www.scaledrone.com/blog/introduction-to-websockets/

socket.io - библиотека абстракций для решения проблем совместимости и фрагментации.

WebSocket - это продвинутая технология, позволяющая открыть постоянное двунаправленное сетевое соединение между браузером пользователя и сервером. С помощью его API вы можете отправить сообщение на сервер и получить ответ без выполнения http запроса, причем этот процесс будет событийно-управляемым.

1. Когда `new WebSocket(url)` создан, он начинает устанавливать соединение. Браузер, при помощи специальных заголовков, спрашивает сервер: «Ты поддерживаешь Websocket?», если «да», они начинают работать по протоколу WebSocket.

Пример заголовков для запроса, который делает `new WebSocket("wss://javascript.info/chat")`.

```
GET /chat
Host: javascript.info
Origin: https://javascript.info
Connection: Upgrade     // клиент хотел бы изменить протокол
Upgrade: websocket      // запрошен протокол «websocket»
Sec-WebSocket-Key: Iv8io/9s+lYFgZWcXczP8Q==  // ключ безопасности
Sec-WebSocket-Version: 13  // версия протокола
```

2. Если сервер согласен переключиться на WebSocket, то он должен отправить в ответ код 101.

```
101 Switching Protocols
Upgrade: websocket
Connection: Upgrade
Sec-WebSocket-Accept: hsBlbuDTkk24srzEOTBUlZAlC2g=  // Sec-WebSocket-Key
```

3. Поток данных состоит из «фреймов», фрагментов данных, которые могут быть отправлены любой стороной (текстовые, бинарные, пинг-понг фреймы и фрейм закрытия соединения).

4. Чтобы закрыть соединение браузер или сервер отправляют «фрейм закрытия соединения» с кодом закрытия и указывают причину в виде текста.

```js
// закрывающая сторона:
socket.close(1000, 'работа закончена');

// другая сторона:
socket.onclose = event => {
  // event.code === 1000
  // event.reason === 'работа закончена'
  // event.wasClean === true (закрыто чисто)
};
```

# SSE

https://www.scaledrone.com/blog/getting-to-know-server-sent-events-sse/

Server-Sent Events - это стандарт, который позволяет потоковую передачу от сервера к клиенту данных через HTTP-соединение. Позволяет работать с данными в реальном времени, используя одно долговечное HTTP-соединение.

- поток передачи данных однонаправленный (от сервера к клиенту).
- является частью спецификации HTML5.
- используется для обновлений данных (информация о ценах/наличие продуктов/обновления новостей.автоматический push).

## Components of SSEs

1. The EventSource API - интерфейс браузера, позволяет клиенту получать push-уведомления от сервера в виде событий DOM. Выполняет задачи: управление подключением к серверу, разбирает полученные данные и определяет границы сообщений.

2. The Event Stream Protocol - простой поток текстовых данных в UTF-8.

# WebSockets and SSEs: сходства

- используют HTTP соединение
- WS обновляет HTTP протокол до протокола WebSocket
- передают данные от клиента к серверу

# SSEs and WebSockets: различия

## WS

- двунаправленная связь между клиентом и сервером (full-duplex)
- может обнаружить разорванное клиентское соединение
- заменяет HTTP соединение на протокол WebSocket после TCP
- подключение: установить и поддерживать связь через TCP socket, listener socket на стороне сервера
- передача binary data и UTF-8

## SSE

- однонаправленная связь между клиентом и сервером
- функции: автоматическое переподключение, id событий, отправка произвольных событий
- подключение: отправить HTTP запрос с особыми заголовками
- ограниченное количество открытых соединений
- передача UTF-8

# SSEs and WebSockets: use cases

<b>WS</b>: многопользовательские игры в режиме реального времени, приложения для обмена сообщениями и чат (двунаправленный поток). 

<b>SSE</b>: обновлять статус, новостные ленты и другие автоматизированные механизмы передачи данных (не нужно отправлять данные от клиента).

## Scaledrone

https://www.scaledrone.com/
